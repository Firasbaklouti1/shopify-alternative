### ==================================================
### SECURITY MODULE TEST SCENARIOS
### ==================================================
@host = http://localhost:8080

### 1.1 SUCCESSFUL REGISTRATION
# @name register
POST {{host}}/api/v1/auth/register
Content-Type: application/json

{
  "storeName": "Store-{{$random.uuid}}",
  "storeSlug": "store-{{$random.uuid}}",
  "email": "merchant-{{$random.uuid}}@test.com",
  "password": "Admin123!",
  "fullName": "John Merchant"
}

> {%
    if (response.status === 200 || response.status === 201) {
        client.global.set("merchantEmail", response.body.ownerEmail || response.body.email);
        client.log("✓ SUCCESS: Registration successful");
    }
%}

###

### 1.2 SUCCESSFUL LOGIN
# @name login
POST {{host}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "{{merchantEmail}}",
  "password": "Admin123!"
}

> {%
    if (response.status === 200) {
        client.global.set("token", response.body.token || response.body.accessToken);
        client.log("✓ SUCCESS: Login successful");
    }
%}

###

### 1.3 INVALID LOGIN CREDENTIALS
POST {{host}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "nonexistent@test.com",
  "password": "WrongPassword123!"
}

> {%
    client.test("Invalid login should fail with 400", function() {
        client.assert(response.status === 400, "Expected 400 for invalid credentials");
    });
%}

###

### 1.4 SQL INJECTION ATTEMPT
POST {{host}}/api/v1/auth/login
Content-Type: application/json

{
  "email": "test' OR '1'='1",
  "password": "anything' OR 'x'='x"
}

> {%
    client.test("SQL injection attempt should fail with 400", function() {
        client.assert(response.status === 400, "SQL injection detected/rejected");
    });
%}
